{"version":3,"file":"index.js","sources":["../../../../src/PlanorService.js","../../../../src/PlanorTemplate.js","../../../../src/Planor.js"],"sourcesContent":["export default class PlanorService {\n  #credentials = {}\n\n  constructor(name, channel) {\n    this.name = name\n    this.channel = channel\n    this.client = null\n    this.opts = {}\n  }\n\n  setCredentials(credentials) {\n    this.#credentials = credentials\n  }\n\n  getCredentials() {\n    return this.#credentials\n  }\n\n  setOpts(opts) {\n    this.opts = opts\n  }\n}\n","import mjml2html from 'mjml'\n\nexport default class PlanorTemplate {\n  #reParser = /({{)[^{}]+(}})/gm\n  #supportedContentTypes = ['text/plain', 'text/html', 'text/mjml']\n  #subject = null\n  #plaintext = null\n  #html = null\n\n  constructor(channel, id, locale, template) {\n    this.id = id\n    this.channel = channel\n    this.locale = locale\n    this.template = Array.isArray(template) ? template : [template]\n\n    this.#verifyTemplate()\n  }\n\n  parse(templateLiterals={}) {\n    // title or sms text\n    const parsed0 = this.#_parse(this.template[0].template, templateLiterals)\n\n    if (this.channel == 'email') this.#subject = parsed0\n    if (this.channel == 'sms') this.#plaintext = parsed0\n\n    // email content\n    if (this.template.length > 1) {\n      const parsed1 = this.#_parse(this.template[1].template, templateLiterals)\n\n      if (this.template[1].type == 'text/mjml') {\n        this.#html = mjml2html(parsed1, {keepComments: false}).html\n      }\n\n      if (this.template[1].type == 'text/html') {\n        this.#html = parsed1\n      }\n\n      if (this.template[1].type == 'text/plain') {\n        this.#plaintext = parsed1\n      }\n    }\n\n    return this\n  }\n\n  getSubject() {\n    return this.#subject\n  }\n\n  getPlainText() {\n    return this.#plaintext\n  }\n\n  getHtml() {\n    return this.#html\n  }\n\n  #_parse(str, props={}) {\n    if (!props || Object.keys(props).length === 0) {\n      return str\n    }\n\n    const matches = str.match(this.#reParser)\n\n    if (!matches) {\n      return str\n    }\n\n    return matches.reduce((memo, exp) => {\n      const prop = exp.slice(2, -2)\n\n      if (props.hasOwnProperty(prop)) {\n        memo = memo.replace(exp, props[prop])\n      }\n\n      return memo\n    }, str)\n  }\n\n  #verifyTemplate() {\n    if (this.channel == 'email' && this.template.length !== 2) {\n      throw new Error('INVALID_TEMPLATE')\n    }\n\n    if (this.channel == 'sms' && this.template.length !== 1) {\n      throw new Error('INVALID_TEMPLATE')\n    }\n\n    for (var i = 0; i < this.template.length; i++) {\n      if (typeof this.template[i] == 'string') {\n        this.template[i] = {type: 'text/plain', template: this.template[i]}\n      }\n\n      if (Object.prototype.toString.call(this.template[i]) != '[object Object]') {\n        throw new Error('INVALID_TEMPLATE')\n      }\n\n      if (this.channel == 'sms' && this.template[i].type != 'text/plain') {\n        throw new Error('INVALID_TEMPLATE')\n      }\n\n      if (this.#supportedContentTypes.indexOf(this.template[i].type) === -1) {\n        throw new Error('INVALID_TEMPLATE')\n      }\n\n      if (!this.template[i].template) {\n        throw new Error('INVALID_TEMPLATE')\n      }\n    }\n  }\n}\n","import {createMimeMessage} from 'mimetext'\nimport createDOMPurify from 'dompurify'\nimport {JSDOM} from 'jsdom'\nimport PlanorService from './PlanorService.js'\nimport PlanorTemplate from './PlanorTemplate.js'\n\nexport default class Planor {\n  #domPurifier = createDOMPurify(new JSDOM('').window)\n  #services = []\n  #templates = []\n  #templateLiterals = []\n  // this is a temporary error chain that keeps errors thrown by services.\n  // resets itself to its initial state after sendEmail method has done.\n  #errors = []\n\n  constructor() {\n\n  }\n\n  async addService(s) {\n    if (s instanceof PlanorService) {\n      this.#services.unshift(s)\n\n      await this.#services[0].getClient()\n    }\n\n    return this\n  }\n\n  getServices() {\n    return this.#services\n  }\n\n  addTemplate(t) {\n    if (t instanceof PlanorTemplate) {\n      this.#templates.unshift(t)\n    }\n\n    return this\n  }\n\n  getTemplates() {\n    return this.#templates\n  }\n\n  async sendSms(template, msgopts, oneTimeTemplateLiterals={}) {\n    const matchedTemplates = this.#templates.filter(\n      _t => _t.channel == 'sms' && _t.id == template\n    )\n\n    if (!matchedTemplates) {\n      throw new Error('MISSING_TEMPLATE')\n    }\n\n    const t = matchedTemplates[0]\n    const templateLiterals = Object.assign({}, this.#templateLiterals, oneTimeTemplateLiterals)\n\n    t.parse(templateLiterals)\n\n    const msg = t.getPlainText()\n\n    return await this.#_sendSms(msg, msgopts)\n  }\n\n  async #_sendSms(msg, msgopts, _ind=0) {\n    if (_ind === 0) this.#reset()\n\n    if (!this.#services[_ind]) {\n      this.#errors.push( new Error('NO_SERVICE_TO_TRY') )\n      return undefined;\n    }\n\n    const s = this.#services[_ind]\n\n    if (s.channel != 'sms') {\n      return await this.#_sendSms(msg, msgopts, _ind+1)\n    }\n\n    try {\n      return await s.send(msg, msgopts)\n    } catch (e) {\n      this.#errors.push(e)\n      return await this.#_sendSms(msg, msgopts, _ind+1)\n    }\n  }\n\n  async sendEmail(template, msgopts, oneTimeTemplateLiterals={}) {\n    const matchedTemplates = this.#templates.filter(\n      _t => _t.channel == 'email' && _t.id == template\n    )\n\n    if (!matchedTemplates) {\n      throw new Error('MISSING_TEMPLATE')\n    }\n\n    const t = matchedTemplates[0]\n    const templateLiterals = Object.assign({}, this.#templateLiterals, oneTimeTemplateLiterals)\n\n    t.parse(templateLiterals)\n\n    const msg = createMimeMessage()\n    if (msgopts.sender) msg.setSender(msgopts.sender)\n    msg.setTo(msgopts.to)\n    if (msgopts.cc) msg.setCc(msgopts.cc)\n    if (msgopts.bcc) msg.setBcc(msgopts.bcc)\n    if (msgopts.headers) msg.setHeaders(msgopts.headers)\n    if (msgopts.attachment) {\n      const [filename, type, base64Data, attachmentHeaders] = msgopts.attachment\n      msg.setAttachment(filename, type, base64Data, attachmentHeaders || {})\n    }\n    msg.setSubject(t.getSubject())\n    if (t.getPlainText()) {\n      msg.setMessage('text/plain', t.getPlainText())\n    }\n    if (t.getHtml()) {\n      msg.setMessage('text/html', t.getHtml())\n      msg.setMessage('text/plain', this.#generatePlainTextVersion(t.getHtml()))\n    }\n\n    return await this.#_sendEmail(msg, msgopts)\n  }\n\n  async #_sendEmail(mimemsg, msgopts, _ind=0) {\n    if (_ind === 0) this.#reset()\n\n    if (!this.#services[_ind]) {\n      this.#errors.push( new Error('NO_SERVICE_TO_TRY') )\n      return undefined;\n    }\n\n    const s = this.#services[_ind]\n\n    if (s.channel != 'email') {\n      return await this.#_sendEmail(mimemsg, msgopts, _ind+1)\n    }\n\n    try {\n      return await s.send(mimemsg, msgopts)\n    } catch (e) {\n      this.#errors.push(e)\n      return await this.#_sendEmail(mimemsg, msgopts, _ind+1)\n    }\n  }\n\n  updateTemplateLiterals(obj) {\n    this.#templateLiterals = Object.assign({}, this.#templateLiterals, obj)\n    return this\n  }\n\n  getTemplateLiterals() {\n    return this.#templateLiterals\n  }\n\n  getErrors() {\n    return this.#errors\n  }\n\n  #generatePlainTextVersion(html) {\n    return this.#domPurifier\n      .sanitize(html, {ALLOWED_TAGS: []})\n      .replace(/[\\r\\n]{2,}/gm, \"\\r\\n\")\n      .replace(/[ ]{2,}/gm, ' ')\n      .trim()\n      .split(/[\\r\\n]/)\n      .map(line => line.trim())\n      .join(\"\\r\\n\")\n  }\n\n  #reset() {\n    this.#errors = []\n  }\n}\n"],"names":["PlanorService","constructor","name","channel","client","opts","setCredentials","credentials","getCredentials","setOpts","PlanorTemplate","id","locale","template","Array","isArray","parse","templateLiterals","parsed0","_classPrivateFieldSet","length","parsed1","type","mjml2html","keepComments","html","getSubject","getPlainText","getHtml","str","props","Object","keys","matches","match","reduce","memo","exp","prop","slice","hasOwnProperty","replace","Error","i","prototype","toString","call","_classPrivateFieldGet","indexOf","Planor","createDOMPurify","JSDOM","window","addService","s","unshift","getClient","getServices","addTemplate","t","getTemplates","sendSms","msgopts","oneTimeTemplateLiterals","matchedTemplates","filter","_t","assign","msg","sendEmail","createMimeMessage","sender","setSender","setTo","to","cc","setCc","bcc","setBcc","headers","setHeaders","attachment","filename","base64Data","attachmentHeaders","setAttachment","setSubject","setMessage","updateTemplateLiterals","obj","getTemplateLiterals","getErrors","_ind","push","undefined","send","e","mimemsg","sanitize","ALLOWED_TAGS","trim","split","map","line","join"],"mappings":"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"}