{"version":3,"file":"index.js","sources":["../../src/PlanorService.js","../../src/PlanorTemplate.js","../../src/Planor.js"],"sourcesContent":["export default class PlanorService {\n  #credentials = {}\n\n  constructor(name, channel) {\n    this.name = name\n    this.channel = channel\n    this.client = null\n    this.opts = {}\n  }\n\n  setCredentials(credentials) {\n    this.#credentials = credentials\n  }\n\n  getCredentials() {\n    return this.#credentials\n  }\n\n  setOpts(opts) {\n    this.opts = opts\n  }\n}\n","import mjml2html from 'mjml'\n\nexport default class PlanorTemplate {\n  #reParser = /({{)[^{}]+(}})/gm\n  #supportedContentTypes = ['text/plain', 'text/html', 'text/mjml']\n  #subject = null\n  #plaintext = null\n  #html = null\n\n  constructor(channel, id, locale, template) {\n    this.id = id\n    this.channel = channel\n    this.locale = locale\n    this.template = Array.isArray(template) ? template : [template]\n\n    this.#verifyTemplate()\n  }\n\n  parse(templateLiterals={}) {\n    // title or sms text\n    const parsed0 = this.#_parse(this.template[0].template, templateLiterals)\n\n    if (this.channel == 'email') this.#subject = parsed0\n    if (this.channel == 'sms') this.#plaintext = parsed0\n\n    // email content\n    if (this.template.length > 1) {\n      const parsed1 = this.#_parse(this.template[1].template, templateLiterals)\n\n      if (this.template[1].type == 'text/mjml') {\n        this.#html = mjml2html(parsed1, {keepComments: false}).html\n      }\n\n      if (this.template[1].type == 'text/html') {\n        this.#html = parsed1\n      }\n\n      if (this.template[1].type == 'text/plain') {\n        this.#plaintext = parsed1\n      }\n    }\n\n    return this\n  }\n\n  getSubject() {\n    return this.#subject\n  }\n\n  getPlainText() {\n    return this.#plaintext\n  }\n\n  getHtml() {\n    return this.#html\n  }\n\n  #_parse(str, props={}) {\n    if (!props || Object.keys(props).length === 0) {\n      return str\n    }\n\n    const matches = str.match(this.#reParser)\n\n    if (!matches) {\n      return str\n    }\n\n    return matches.reduce((memo, exp) => {\n      const prop = exp.slice(2, -2)\n\n      if (props.hasOwnProperty(prop)) {\n        memo = memo.replace(exp, props[prop])\n      }\n\n      return memo\n    }, str)\n  }\n\n  #verifyTemplate() {\n    if (this.channel == 'email' && this.template.length !== 2) {\n      throw new Error('INVALID_TEMPLATE')\n    }\n\n    if (this.channel == 'sms' && this.template.length !== 1) {\n      throw new Error('INVALID_TEMPLATE')\n    }\n\n    for (var i = 0; i < this.template.length; i++) {\n      if (typeof this.template[i] == 'string') {\n        this.template[i] = {type: 'text/plain', template: this.template[i]}\n      }\n\n      if (Object.prototype.toString.call(this.template[i]) != '[object Object]') {\n        throw new Error('INVALID_TEMPLATE')\n      }\n\n      if (this.channel == 'sms' && this.template[i].type != 'text/plain') {\n        throw new Error('INVALID_TEMPLATE')\n      }\n\n      if (this.#supportedContentTypes.indexOf(this.template[i].type) === -1) {\n        throw new Error('INVALID_TEMPLATE')\n      }\n\n      if (!this.template[i].template) {\n        throw new Error('INVALID_TEMPLATE')\n      }\n    }\n  }\n}\n","import {createMimeMessage} from 'mimetext'\nimport createDOMPurify from 'dompurify'\nimport {JSDOM} from 'jsdom'\nimport PlanorService from './PlanorService.js'\nimport PlanorTemplate from './PlanorTemplate.js'\n\nexport default class Planor {\n  #domPurifier = createDOMPurify(new JSDOM('').window)\n  #services = []\n  #templates = []\n  #templateLiterals = []\n  // this is a temporary error chain that keeps errors thrown by services.\n  // resets itself to its initial state after sendEmail method has done.\n  #errors = []\n\n  constructor() {\n\n  }\n\n  async addService(s) {\n    if (s instanceof PlanorService) {\n      this.#services.unshift(s)\n\n      await this.#services[0].getClient()\n    }\n\n    return this\n  }\n\n  getServices() {\n    return this.#services\n  }\n\n  addTemplate(t) {\n    if (t instanceof PlanorTemplate) {\n      this.#templates.unshift(t)\n    }\n\n    return this\n  }\n\n  getTemplates() {\n    return this.#templates\n  }\n\n  async sendSms(template, msgopts, oneTimeTemplateLiterals={}) {\n    const matchedTemplates = this.#templates.filter(\n      _t => _t.channel == 'sms' && _t.id == template\n    )\n\n    if (!matchedTemplates) {\n      throw new Error('MISSING_TEMPLATE')\n    }\n\n    const t = matchedTemplates[0]\n    const templateLiterals = Object.assign({}, this.#templateLiterals, oneTimeTemplateLiterals)\n\n    t.parse(templateLiterals)\n\n    const msg = t.getPlainText()\n\n    return await this.#_sendSms(msg, msgopts)\n  }\n\n  async #_sendSms(msg, msgopts, _ind=0) {\n    if (_ind === 0) this.#reset()\n\n    if (!this.#services[_ind]) {\n      this.#errors.push( new Error('NO_SERVICE_TO_TRY') )\n      return undefined;\n    }\n\n    const s = this.#services[_ind]\n\n    if (s.channel != 'sms') {\n      return await this.#_sendSms(msg, msgopts, _ind+1)\n    }\n\n    try {\n      return await s.send(msg, msgopts)\n    } catch (e) {\n      this.#errors.push(e)\n      return await this.#_sendSms(msg, msgopts, _ind+1)\n    }\n  }\n\n  async sendEmail(template, msgopts, oneTimeTemplateLiterals={}) {\n    const matchedTemplates = this.#templates.filter(\n      _t => _t.channel == 'email' && _t.id == template\n    )\n\n    if (!matchedTemplates) {\n      throw new Error('MISSING_TEMPLATE')\n    }\n\n    const t = matchedTemplates[0]\n    const templateLiterals = Object.assign({}, this.#templateLiterals, oneTimeTemplateLiterals)\n\n    t.parse(templateLiterals)\n\n    const msg = createMimeMessage()\n    if (msgopts.sender) msg.setSender(msgopts.sender)\n    msg.setTo(msgopts.to)\n    if (msgopts.cc) msg.setCc(msgopts.cc)\n    if (msgopts.bcc) msg.setBcc(msgopts.bcc)\n    if (msgopts.headers) msg.setHeaders(msgopts.headers)\n    if (msgopts.attachment) {\n      const [filename, type, base64Data, attachmentHeaders] = msgopts.attachment\n      msg.setAttachment(filename, type, base64Data, attachmentHeaders || {})\n    }\n    msg.setSubject(t.getSubject())\n    if (t.getPlainText()) {\n      msg.setMessage('text/plain', t.getPlainText())\n    }\n    if (t.getHtml()) {\n      msg.setMessage('text/html', t.getHtml())\n      msg.setMessage('text/plain', this.#generatePlainTextVersion(t.getHtml()))\n    }\n\n    return await this.#_sendEmail(msg, msgopts)\n  }\n\n  async #_sendEmail(mimemsg, msgopts, _ind=0) {\n    if (_ind === 0) this.#reset()\n\n    if (!this.#services[_ind]) {\n      this.#errors.push( new Error('NO_SERVICE_TO_TRY') )\n      return undefined;\n    }\n\n    const s = this.#services[_ind]\n\n    if (s.channel != 'email') {\n      return await this.#_sendEmail(mimemsg, msgopts, _ind+1)\n    }\n\n    try {\n      return await s.send(mimemsg, msgopts)\n    } catch (e) {\n      this.#errors.push(e)\n      return await this.#_sendEmail(mimemsg, msgopts, _ind+1)\n    }\n  }\n\n  updateTemplateLiterals(obj) {\n    this.#templateLiterals = Object.assign({}, this.#templateLiterals, obj)\n    return this\n  }\n\n  getTemplateLiterals() {\n    return this.#templateLiterals\n  }\n\n  getErrors() {\n    return this.#errors\n  }\n\n  #generatePlainTextVersion(html) {\n    return this.#domPurifier\n      .sanitize(html, {ALLOWED_TAGS: []})\n      .replace(/[\\r\\n]{2,}/gm, \"\\r\\n\")\n      .replace(/[ ]{2,}/gm, ' ')\n      .trim()\n      .split(/[\\r\\n]/)\n      .map(line => line.trim())\n      .join(\"\\r\\n\")\n  }\n\n  #reset() {\n    this.#errors = []\n  }\n}\n"],"names":[],"mappings":"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"}